name: ğŸ“š EduArt Archive Automation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # ë§¤ì£¼ ì¼ìš”ì¼ ì˜¤í›„ 6ì‹œì— ì£¼ê°„ ë¦¬í¬íŠ¸ ìƒì„±
    - cron: '0 18 * * 0'

jobs:
  update-package-index:
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, 'package') || github.event_name == 'schedule'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: ğŸ“Š íŒ¨í‚¤ì§€ í˜„í™© ì—…ë°ì´íŠ¸
      run: |
        echo "ğŸ” ë°±ì„œíŒ¨í‚¤ì§€ ìŠ¤ìº” ì¤‘..."
        
        # íŒ¨í‚¤ì§€ ê°œìˆ˜ ê³„ì‚°
        TOTAL_PACKAGES=$(find whitepaper-packages -name "package-*" -type d | wc -l)
        ACTIVE_PACKAGES=$(find whitepaper-packages -name "1-whitepaper.md" | wc -l)
        COMPLETED_PACKAGES=$(find whitepaper-packages -name "index.html" | wc -l)
        
        echo "ğŸ“ˆ í†µê³„:"
        echo "- ì´ íŒ¨í‚¤ì§€: $TOTAL_PACKAGES"
        echo "- í™œì„± íŒ¨í‚¤ì§€: $ACTIVE_PACKAGES" 
        echo "- ì™„ì„± íŒ¨í‚¤ì§€: $COMPLETED_PACKAGES"
        
        # packages-index.md ìë™ ì—…ë°ì´íŠ¸
        DATE=$(date +"%Y-%m-%d")
        sed -i "s/>.*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸.*/>**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: $DATE/g" whitepaper-packages/packages-index.md
        sed -i "s/>.*ì´ íŒ¨í‚¤ì§€ ìˆ˜.*/>**ì´ íŒ¨í‚¤ì§€ ìˆ˜**: $TOTAL_PACKAGESê°œ (í…œí”Œë¦¿ ì œì™¸)/g" whitepaper-packages/packages-index.md
        sed -i "s/>.*ì™„ì„±ëœ í”„ë¡œì íŠ¸.*/>**ì™„ì„±ëœ í”„ë¡œì íŠ¸**: $COMPLETED_PACKAGESê°œ/g" whitepaper-packages/packages-index.md
    
    - name: ğŸ“ ìë™ ì»¤ë°‹
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "EduArt Archive Bot"
        git add whitepaper-packages/packages-index.md
        git diff --staged --quiet || git commit -m "ğŸ¤– ìë™ ì—…ë°ì´íŠ¸: íŒ¨í‚¤ì§€ í˜„í™© $(date +%Y-%m-%d)"
        git push

  weekly-report:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: ğŸ“Š ì£¼ê°„ ë¦¬í¬íŠ¸ ìƒì„±
      run: |
        WEEK_NUM=$(date +%V)
        YEAR=$(date +%Y)
        REPORT_FILE="chat-logs/summary-week-$YEAR-$WEEK_NUM.md"
        
        echo "# ğŸ“Š ì£¼ê°„ ìš”ì•½ Week $YEAR-$WEEK_NUM" > $REPORT_FILE
        echo "" >> $REPORT_FILE
        echo "## ğŸ¯ ì´ë²ˆ ì£¼ ì£¼ìš” ì„±ê³¼" >> $REPORT_FILE
        
        # ì´ë²ˆ ì£¼ ì»¤ë°‹ ë¶„ì„
        git log --since="7 days ago" --pretty=format:"- %s (%an)" >> $REPORT_FILE
        
        echo "" >> $REPORT_FILE
        echo "---" >> $REPORT_FILE
        echo "**ìë™ ìƒì„± ë¦¬í¬íŠ¸** - $(date)" >> $REPORT_FILE
    
    - name: ğŸš€ ë¦¬í¬íŠ¸ ì»¤ë°‹
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "EduArt Weekly Bot"
        git add chat-logs/
        git commit -m "ğŸ“Š ì£¼ê°„ ë¦¬í¬íŠ¸ ìë™ ìƒì„± $(date +%Y-%m-%d)"
        git push

  deploy-webapps:
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, 'webapp') || contains(github.event.head_commit.message, 'ğŸš€')
    
    steps:
    - uses: actions/checkout@v3
    
    - name: ğŸŒ GitHub Pages ë°°í¬ ì¤€ë¹„
      run: |
        echo "ğŸ” ë°°í¬ ê°€ëŠ¥í•œ ì›¹ì•± ìŠ¤ìº”..."
        
        # ì™„ì„±ëœ ì›¹ì•± ì°¾ê¸°
        find whitepaper-packages -name "index.html" -path "*/4-webapp-code/*" | while read webapp; do
          echo "âœ… ë°œê²¬: $webapp"
          # í–¥í›„ ìë™ ë°°í¬ ë¡œì§ ì¶”ê°€
        done
        
        echo "ğŸ‰ ë°°í¬ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ!"

  quality-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: ğŸ” í’ˆì§ˆ ê²€ì‚¬
      run: |
        echo "ğŸ“‹ ì•„ì¹´ì´ë¸Œ í’ˆì§ˆ ê²€ì‚¬ ì‹œì‘..."
        
        # ê¹¨ì§„ ë§í¬ ì²´í¬
        echo "ğŸ”— ë‚´ë¶€ ë§í¬ ê²€ì¦..."
        
        # í…œí”Œë¦¿ ì¼ê´€ì„± ì²´í¬
        echo "ğŸ“„ í…œí”Œë¦¿ ì¼ê´€ì„± ê²€ì¦..."
        
        # íŒŒì¼ëª… ê·œì¹™ ì²´í¬
        echo "ğŸ“‚ íŒŒì¼ëª… ê·œì¹™ ê²€ì¦..."
        
        echo "âœ… í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ!"
